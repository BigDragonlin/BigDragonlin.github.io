(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{516:function(n,s,a){"use strict";a.r(s);var e=a(7),t=Object(e.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("div",{staticClass:"language-C++ line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('#include <iostream>\n//ODBC用到的头文件\n#include <windows.h>\n#include <sql.h>\n#include <sqlext.h>\n#include <sqltypes.h>\n#include <tchar.h>\n#include <io.h>      // 包含 _setmode\n#include <fcntl.h>   // 包含 _O_U16TEXT\nusing namespace std;\n\nvoid check(SQLRETURN ret, wstring type, SQLHENV hEnv, SQLHDBC hDbc, SQLHSTMT hStmt) {\n    if (ret == SQL_ERROR) {\n        wcout << type << _T("失败！") << endl;\n        //获取错误信息 \n        SQLTCHAR state[128] = { 0 };\n        SQLTCHAR msg[128] = { 0 };\n        SQLRETURN ret = SQLError(hEnv, hDbc, hStmt, state, NULL, msg, sizeof(msg), NULL);\n        wcout << state << " " << msg << endl;\n\n        exit(-1);\n    }\n}\n\nint main()\n{\n    //设置为中文兼容unicode\n    _wsetlocale(LC_ALL, L"chs");\n\n    // 设置控制台输出编码为UTF-8\n    _setmode(_fileno(stdout), _O_U16TEXT);\n\n    // 声明环境句柄\n    SQLHENV hEnv = NULL;\n    //声明连接句柄\n    SQLHDBC hDbc = NULL;\n    //声明语句句柄\n    SQLHSTMT hStmt = NULL;\n    //声明返回值\n    SQLRETURN ret;\n\n    // SQL_HANDLE_ENV;  sql handle environment 环境\n    // SQL_HANDLE_DBC; sql handle database connection 数据库连接\n    // SQL_HANDLE_STMT; sql handle statement 执行sql语句\n    // SQL_HANDLE_DESC; sql handle descriptor 描述数据的属性\n    \n    //分配环境句柄\n    ret = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &hEnv); \n    check(ret, _T("分配环境句柄"), hEnv, hDbc, hStmt);\n\n    //设定ODBC版本 sql set environment attribute\n    ret = SQLSetEnvAttr(hEnv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER)SQL_OV_ODBC3, 0);\n    check(ret, _T("ODBC版本设置"), hEnv, hDbc, hStmt);\n    \n    //分配数据库连接句柄\n    ret = SQLAllocHandle(SQL_HANDLE_DBC, hEnv, &hDbc);\n    check(ret, _T("分配连接句柄"), hEnv, hDbc, hStmt);\n    \n    //根据DSN连接数据库，SQL_NTS为自动计算前面字符串长度\n    // 使用SQLDriverConnect并指定连接字符串\n    SQLTCHAR connectionString[] = _T("Driver={SQL Server};Server=172.16.10.251,10097;Database=gameconfig;Uid=fz536;Pwd=G4H7cA3pILjo;");\n    //sql type char\n    SQLTCHAR outConnString[1024];\n    SQLSMALLINT outConnStringLen;\n\n    //SQL_NTS是sql null terminated string\n    ret = SQLDriverConnect(hDbc, NULL, connectionString,\n        SQL_NTS, outConnString, 1024, &outConnStringLen, SQL_DRIVER_NOPROMPT);\n\n    check(ret, _T("连接数据库"), hEnv, hDbc, hStmt);\n    wcout << _T("连接数据库成功！") << endl;\n\n    // 分配语句句柄\n    ret = SQLAllocHandle(SQL_HANDLE_STMT, hDbc, &hStmt);\n    check(ret, _T("分配语句句柄"), hEnv, hDbc, hStmt);\n\n    // sql查询语句\n    SQLTCHAR sql[] = _T("SELECT 道具名称 FROM gameconfig.dbo.gcf_item WHERE 道具名称 LIKE \'%剑%\'");\n    ret = SQLExecDirect(hStmt, sql, SQL_NTS); // SQL_NTS为自动计算前面字符串长度\n    check(ret, _T("执行查询语句"), hEnv, hDbc, hStmt);\n\n    // 绑定列\n    TCHAR name[128] = { 0 };\n    SQLLEN len;\n\n    // SQLRETURN SQLBindCol(\n    // SQLHSTMT       StatementHandle,  // 语句句柄\n    // SQLUSMALLINT   ColumnNumber,     // 列号，从1开始\n    // SQLSMALLINT    TargetType,       // 目标类型，表示应用程序中存储数据的类型\n    // SQLPOINTER     TargetValuePtr,   // 目标指针，指向存储数据的缓冲区\n    // SQLLEN         BufferLength,     // 缓冲区长度\n    // SQLLEN        *StrLen_or_Ind     // 指向实际数据长度或指示器的指针\n    // );\n    // 这段代码绑定了结果集的第一列到 name 缓冲区。\n    // 当我们调用 SQLFetch 时，第一列的数据会被自动放入 name 缓冲区。\n    \n    ret = SQLBindCol(hStmt, 1, SQL_C_WCHAR, name, sizeof(name), &len);\n    check(ret, _T("绑定列"), hEnv, hDbc, hStmt);\n\n    ret = SQLFetch(hStmt);\n    while (ret != SQL_NO_DATA)\n    {\n        wcout << name << endl;\n        ZeroMemory(name, sizeof(name));\n        ret = SQLFetch(hStmt);\n    }\n    \n    //释放语句句柄\n    if (hStmt) {\n        SQLFreeHandle(SQL_HANDLE_STMT, hStmt);\n    }\n    //释放连接句柄\n    if (hDbc) {\n        SQLDisconnect(hDbc);\n        SQLFreeHandle(SQL_HANDLE_DBC, hDbc);\n    }\n    //释放环境句柄\n    if (hEnv) {\n        SQLFreeHandle(SQL_HANDLE_ENV, hEnv);\n    }\n    wcout << _T("断开数据库连接！") << endl;\n    return 0;\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br"),s("span",{staticClass:"line-number"},[n._v("110")]),s("br"),s("span",{staticClass:"line-number"},[n._v("111")]),s("br"),s("span",{staticClass:"line-number"},[n._v("112")]),s("br"),s("span",{staticClass:"line-number"},[n._v("113")]),s("br"),s("span",{staticClass:"line-number"},[n._v("114")]),s("br"),s("span",{staticClass:"line-number"},[n._v("115")]),s("br"),s("span",{staticClass:"line-number"},[n._v("116")]),s("br"),s("span",{staticClass:"line-number"},[n._v("117")]),s("br"),s("span",{staticClass:"line-number"},[n._v("118")]),s("br"),s("span",{staticClass:"line-number"},[n._v("119")]),s("br"),s("span",{staticClass:"line-number"},[n._v("120")]),s("br"),s("span",{staticClass:"line-number"},[n._v("121")]),s("br"),s("span",{staticClass:"line-number"},[n._v("122")]),s("br"),s("span",{staticClass:"line-number"},[n._v("123")]),s("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);
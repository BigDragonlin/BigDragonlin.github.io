(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{480:function(s,e,n){"use strict";n.r(e);var r=n(4),a=Object(r.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("观察者模式涉及两个角色：被观察者（Subject）和观察者（Observer）。\n被观察者负责维护观察者的列表，并在状态改变时通知它们。观察者通过一个统一的接口接收到通知，并做出相应的响应。")]),s._v(" "),e("p",[s._v("在C++中，我们通常使用抽象类（含有纯虚函数的类）来定义接口。")]),s._v(" "),e("p",[s._v("以下是一个使用C++实现观察者模式的例子：")]),s._v(" "),e("div",{staticClass:"language-c++ line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('#include <iostream>\n#include <vector>\n#include <algorithm>\n\n// 观察者抽象类\nclass Observer {\npublic:\n    virtual ~Observer() {}\n\n    virtual void update(const std::string &message_from_subject) = 0;\n};\n\n// 被观察者类\nclass Subject {\npublic:\n    virtual ~Subject() {}\n\n    virtual void attach(Observer *observer) {\n        list_observer_.push_back(observer);\n    }\n\n    virtual void detach(Observer *observer) {\n        list_observer_.erase(std::remove(list_observer_.begin(), list_observer_.end(), observer),\n                             list_observer_.end());\n    }\n\n    virtual void notify() {\n        for (Observer *observer: list_observer_) {\n            observer->update(message_);\n        }\n    }\n\n    void createMessage(std::string message = "Empty") {\n        this->message_ = message;\n        notify();\n    }\n\nprivate:\n    std::vector<Observer *> list_observer_;\n    std::string message_;\n};\n\n// 具体观察者\nclass ConcreteObserver : public Observer {\npublic:\n    ConcreteObserver(Subject &subject) : subject_(subject) {\n        this->subject_.attach(this);\n        std::cout << "Hi, I\'m the ConcreteObserver \\"" << ++ConcreteObserver::static_number_ << "\\".\\n";\n        this->number_ = ConcreteObserver::static_number_;\n    }\n\n    virtual ~ConcreteObserver() {\n        std::cout << "Goodbye, I was the Observer \\"" << this->number_ << "\\".\\n";\n    }\n\n    void update(const std::string &message_from_subject) override {\n        message_from_subject_ = message_from_subject;\n        printInfo();\n    }\n\n    void removeFromTheList() {\n        subject_.detach(this);\n        std::cout << "Observer \\"" << number_ << "\\" removed from the list.\\n";\n    }\n\n    void printInfo() {\n        std::cout << "Observer \\"" << this->number_ << "\\": a new message is available --\x3e "\n                  << this->message_from_subject_ << "\\n";\n    }\n\nprivate:\n    std::string message_from_subject_;\n    Subject &subject_;\n    static int static_number_;\n    int number_;\n};\n\nint ConcreteObserver::static_number_ = 0;\n\nvoid clientCode() {\n    Subject *subject = new Subject;\n    ConcreteObserver *observer1 = new ConcreteObserver(*subject);\n    ConcreteObserver *observer2 = new ConcreteObserver(*subject);\n    ConcreteObserver *observer3 = new ConcreteObserver(*subject);\n    ConcreteObserver *observer4;\n    ConcreteObserver *observer5;\n\n    subject->createMessage("Hello World! :D");\n    observer3->removeFromTheList();\n\n    subject->createMessage("The weather is hot today! :p");\n    observer4 = new ConcreteObserver(*subject);\n\n    observer2->removeFromTheList();\n    observer5 = new ConcreteObserver(*subject);\n\n    subject->createMessage("My new car is great! ;)");\n    observer5->removeFromTheList();\n\n    observer4->removeFromTheList();\n    observer1->removeFromTheList();\n\n    delete observer5;\n    delete observer4;\n    delete observer3;\n    delete observer2;\n    delete observer1;\n    delete subject;\n}\n\nint main() {\n    clientCode();\n    return 0;\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br")])]),e("p",[s._v("在这个例子中，Subject类有方法attach用于添加观察者，detach用于移除观察者，notify用于当有消息时通知所有的观察者。ConcreteObserver类实现了Observer接口，并在接收到更新时打印消息。")]),s._v(" "),e("p",[s._v("最后，clientCode函数模拟了客户端使用观察者模式的情景：创建了一个Subject和几个ConcreteObserver，并且演示了消息的更新和观察者的添加与移除。")]),s._v(" "),e("p",[s._v("通过这种方式，Subject的状态变化时，所有注册的Observer都会收到通知并作出响应，而无需Subject知道具体的Observer是谁，这就实现了解耦合。")]),s._v(" "),e("p",[s._v("这就是观察者模式在C++中的实现。它是事件驱动程序设计的核心，并在现代C++应用程序中广泛使用。")])])}),[],!1,null,null,null);e.default=a.exports}}]);